import os
import json
import time
import random
import numpy as np

from tqdm import trange

from src.utils.config import get_config
from src.utils.utils import set_seeds, set_cuda_device, load_args
from src.envs.make_env import make_env
from src.algo.lgmarl_diff import LanguageGroundedMARL

def render(cfg, envs):
    if cfg.use_render:
        envs.render("human")
    if cfg.render_wait_input:
        input()
    else:
        time.sleep(0.1)

def interact(cfg):
    if cfg.interact:
        add_mess = input("Input message:")
        if len(add_mess):
            add_mess = add_mess.split(" ")
        else:
            add_mess = []
    else:
        add_mess = None
    return add_mess

def run_eval(cfg):
    # Get pretrained stuff
    assert cfg.model_dir is not None, "Must provide model_dir"
    load_args(cfg, eval=True)
    if ',' in cfg.model_dir:
        paths = cfg.model_dir.split(',')
        pretrained_model_path = []
        for p in paths:
            pretrained_model_path.append(os.path.join(p, "model_ep.pt"))
            assert os.path.isfile(pretrained_model_path[-1]), "No model checkpoint found at" + str(pretrained_model_path[-1])
        # print("Loading checkpoints from runs", paths)
    else:
        pretrained_model_path = os.path.join(cfg.model_dir, "model_ep.pt")
        assert os.path.isfile(pretrained_model_path), "No model checkpoint found at" + str(pretrained_model_path)
    # print("Starting eval with config:")
    # print(cfg)
    # cfg.comm_type = "language"
    # if cfg.comm_type == "perfect":
    #     cfg.comm_type = "language_sup"

    set_seeds(cfg.seed)

    # Set training device
    device = set_cuda_device(cfg)

    # Get eval scenarios
    init_positions = None
    if cfg.eval_scenario is not None:
        with open(cfg.eval_scenario, 'r') as f:
            init_positions = json.load(f)
    
    # Create train environment
    envs, parser = make_env(
        cfg, cfg.n_parallel_envs, init_positions=init_positions)
    
    # Create model
    n_agents = envs.n_agents
    obs_space = envs.observation_space
    shared_obs_space = envs.shared_observation_space
    act_space = envs.action_space
    model = LanguageGroundedMARL(
        cfg, 
        n_agents, 
        obs_space, 
        shared_obs_space, 
        act_space,
        parser, 
        device,
        None,
        comm_eps_start=0.0)

    # Load params
    model.load(pretrained_model_path)

    obs = envs.reset()
    parsed_obs = parser.get_perfect_messages(obs)

    render(cfg, envs)

    model.init_episode(obs, parsed_obs)
    model.prep_rollout(device)

    count_returns = np.zeros(cfg.n_parallel_envs)
    # returns = []
    returns = np.zeros(cfg.n_parallel_envs)
    env_dones = np.zeros(cfg.n_parallel_envs)
    for ep_s_i in range(0, cfg.rollout_length):
        # add_mess = interact(cfg)
        
        # Get action
        actions, agent_messages, _, comm_rewards \
            = model.act(deterministic=True)

        # Perform action and get reward and next obs
        next_obs, rewards, dones, infos = envs.step(actions)


        if cfg.n_parallel_envs == 1:
            ll = model.model.lang_learner if type(model.model.lang_learner) != list \
                else model.model.lang_learner[0]
            decoded_messages = ll.word_encoder.decode_batch(
                agent_messages.squeeze(0))
        
            print(f"\nStep #{ep_s_i + 1}")
            print("Observations", obs)
            print("Perfect Messages", parsed_obs)
            print("Agent Messages", decoded_messages)
            print("Actions (t-1)", actions)
            print("Rewards", rewards)
            print("Communication Rewards", comm_rewards)

        obs = next_obs
        parsed_obs = parser.get_perfect_messages(obs)
        model.store_exp(obs, parsed_obs, rewards, dones)

        count_returns += rewards.mean(-1)
        render(cfg, envs)

        dones = dones.all(axis=1)
        new_dones = dones * (1 - env_dones) == True
        if True in new_dones:
            env_dones += new_dones

            returns[new_dones] = count_returns[new_dones]
            # count_returns *= (1 - env_dones)
            if ep_s_i == cfg.rollout_length - 1:
                break
            # print(f"ENV DONE: {int(sum(env_dones))} / {cfg.n_parallel_envs}")
            if env_dones.all():
                break
            
    envs.close()

    # print("Done", len(returns), "complete episodes.")
    print("Returns", returns)
    # print("Mean return:", sum(returns) / len(returns))

    return sum(returns) / len(returns)

if __name__ == '__main__':
    # Load config
    parser = get_config()
    cfg = parser.parse_args()

    random.seed(cfg.seed)

    # returns = np.zeros(cfg.n_eval_runs)
    returns = []
    for i in trange(cfg.n_eval_runs):
        # print(f"Run {i + 1}/{cfg.n_eval_runs}")
        cfg.seed = random.randint(0, 1000000)
        # cfg.seed = [314932, ]
        # returns[i] = run_eval(cfg)
        r = run_eval(cfg)
        if r in returns:
            print("SAMEEEEEEEEEEEEEE", cfg.seed, r)
        else:
            print(cfg.seed, r)
        returns.append(r)

    print(returns, returns.mean(), returns.std(), np.median(returns))
    print(cfg.model_dir)
    

# Returns [  3.1   -2.4    2.6   -2.9    9.67  -1.9   -0.9   -0.4    4.6   -1.4
#    5.71  -2.9  -11.4   -0.9    4.1   -0.4    4.6    4.6    8.65   2.6
#    8.25  -0.9    4.6    4.1 ]
# 260462 1.6991666666666683
#   0%|                                                             | 1/1000 [00:06<1:48:38,  6.52s/it]Returns [ 2.1   4.6   4.6   3.1   7.16 -0.4   1.6  -0.4   4.1  -1.9   7.76  4.6
#  -7.4  -0.4   3.6  -0.4   4.6   4.1   7.24  3.6  -5.9  -0.4   9.71  9.11]
# 170211 2.6825000000000014
#   0%|                                                             | 2/1000 [00:13<1:50:23,  6.64s/it]Returns [-3.9  -3.4   4.6  -1.9   7.62  9.14  4.6  -0.4   4.6   3.1   9.1   6.64
#  -4.4  -0.4  -0.4  -0.4   9.68  4.6   4.1   3.6   3.6  -0.4   9.36 -0.4 ]
# 919400 2.8475000000000015
#   0%|▏                                                            | 3/1000 [00:19<1:49:50,  6.61s/it]Returns [ 1.6   3.6  -2.9  -0.9  -0.9   3.1   4.1   3.1  -0.9  -0.4   4.13  0.1
#  -4.4   4.1   9.69 -0.4   8.62  4.6   8.68  1.6   5.75  9.62  6.18  4.6 ]
# 231211 3.015416666666668
#   0%|▏                                                            | 4/1000 [00:26<1:49:59,  6.63s/it]Returns [-1.9  -1.9   4.6   4.6   7.13 -0.9   3.1   9.25  4.6  -0.4   4.71  3.6
#  -3.9  -0.4   4.1  -0.4  -0.4   4.6   4.1   8.67  9.18  4.6   5.63 -0.4 ]
# 420939 2.9945833333333347
#   0%|▎                                                            | 5/1000 [00:33<1:49:31,  6.60s/it]Returns [ 4.6   4.1   4.6  -0.4   4.1   6.18  2.6   4.6  -2.9  -1.4   3.1   2.6
#  -5.9  -0.4   3.6   4.6   4.6   4.6   9.64  3.6   9.87 -0.4   4.1  -0.4 ]
# 617888 2.8870833333333352
#   1%|▎                                                            | 6/1000 [00:39<1:49:52,  6.63s/it]Returns [-1.4  -0.4  -0.9  -0.4  -1.9   4.6   5.16  3.6   4.6  -0.4   8.66  3.6
#  -6.4   4.1   8.6  -0.4   0.6   4.6  -0.4   3.6   3.1   4.6   3.1   4.6 ]
# 25704 2.271666666666669
#   1%|▍                                                            | 7/1000 [00:46<1:49:56,  6.64s/it]Returns [-1.4   4.6  -0.4  -0.4   3.66  3.6   2.6  -0.4  -0.9   4.6   4.14  9.67
#  -5.4   8.69  8.1  -0.4   3.6   4.1   8.16  4.6   2.6  -1.4   4.6  -0.4 ]
# 92106 2.759166666666669
#   1%|▍                                                            | 8/1000 [00:53<1:50:16,  6.67s/it]Returns [ 0.6  -0.4  -0.9  -0.4   7.19  3.1   8.63  8.74 -0.4   4.6   3.1   3.1
#  -2.4   3.1   7.65 -0.4  -0.4   4.6   4.1   3.6   8.72  4.1   3.6   4.6 ]
# 128351 3.24291666666667
#   1%|▌                                                            | 9/1000 [00:59<1:49:25,  6.63s/it]Returns [ 8.13  4.1  -0.4   5.11  3.6   0.1   1.6   8.63 -0.4   4.1   8.63  7.25
#  -2.4   4.1   4.1  -0.4   3.1   4.6   4.6   3.6   8.9  -0.4   4.6   4.1 ]
# 586817 3.706250000000002
#   1%|▌                                                           | 10/1000 [01:06<1:49:26,  6.63s/it]Returns [-0.4  -0.4   4.6   4.1   8.74  2.6   3.1  -4.4  -0.4   3.1  -5.4   5.73
#  -7.9   4.1   4.1  -0.4   4.1   3.6  -1.9   3.1   8.6  -0.4   9.15  4.1 ]
# 569015 2.1341666666666685
#   1%|▋                                                           | 11/1000 [01:12<1:49:12,  6.63s/it]Returns [ 1.6   4.6  -0.4  -0.4  -5.4   3.6  -1.4   9.62 -0.4   4.6  -6.4   7.17
#  -4.9  -0.4   2.6   4.6   8.62  4.1   4.6   3.6   6.67  3.1   5.16 -0.4 ]
# 188088 2.2558333333333356
#   1%|▋                                                           | 12/1000 [01:19<1:48:00,  6.56s/it]Returns [  4.1    9.13  -4.9    4.6   -0.4   -0.9    7.12  -0.4   -0.4    1.6
#    8.68  -1.4  -11.4    4.1   -0.9    4.6    9.65   4.6    3.6    3.6
#   -0.4    4.1   -6.9    4.6 ]
# 291994 1.920000000000002
#   1%|▊                                                           | 13/1000 [01:25<1:44:51,  6.37s/it]Returns [ 1.6  -0.4   4.1   9.1   7.14  4.6   2.1  -1.4   9.65  4.6   9.15  2.6
#  -2.9  -0.4  -0.9   4.6  -0.9   8.6   4.1   8.11  6.18  4.1   9.17 -0.4 ]
# 435485 3.841666666666668
#   1%|▊                                                           | 14/1000 [01:30<1:41:18,  6.16s/it]Returns [ 0.6   4.6   4.6  -0.4   1.1   4.6   3.6   1.6  -0.4   4.1   3.1   1.6
#  -4.9   4.6   8.18 -0.4   8.11  4.6   9.23  3.6  -0.9  -0.4   8.69 -0.4 ]
# 328065 2.862916666666669
#   2%|▉                                                           | 15/1000 [01:37<1:41:18,  6.17s/it]Returns [ 1.6  -0.4   7.64 -0.4   9.63 -4.9   4.6  -0.4  -0.9  -0.4   2.1   2.6
#  -3.9   4.6   8.67 -0.4   3.6  -2.9   9.67  4.1   3.6   4.1  -2.9  -0.9 ]
# 248075 2.0045833333333354
#   2%|▉                                                           | 16/1000 [01:42<1:38:08,  5.98s/it]Returns [ 2.1   2.6   4.6  -0.4   5.18 -6.9   9.15  3.1   4.1  -0.4   7.6   7.17
#  -3.4   4.6   3.1   4.6   4.6   4.1   8.68  7.6   8.61 -0.9   7.7  -0.4 ]
# 981756 3.6162500000000026
#   2%|█                                                           | 17/1000 [01:49<1:40:44,  6.15s/it]Returns [-2.4  -2.9   9.65  3.6   6.61 -1.4   2.6   3.6  -0.4  -0.9   6.1   3.6
#  -4.9   8.73  8.2   4.6   8.64  3.6  -0.4   2.1   8.82 -0.4   3.1  -0.4 ]
# 283655 2.8937500000000025
#   2%|█                                                           | 18/1000 [01:56<1:44:01,  6.36s/it]Returns [-7.9  -1.4  -1.9   3.1   9.79 -5.9  -4.4  -0.4  -0.4   3.6  -1.4   7.7
#  -4.4   4.6   9.66 -0.9   4.6   4.6   7.64  3.1  -0.9   4.1   0.1  -0.4 ]
# 386217 1.345416666666669
#   2%|█▏                                                          | 19/1000 [02:02<1:45:44,  6.47s/it]Returns [-4.4  -0.4   4.6  -0.9   9.74 -1.4   3.6   2.6  -1.9  -0.9   2.6   8.26
#  -8.9  -1.4   4.1   4.6   9.13  3.6  -0.9  -1.4   0.1  -2.9   2.6  -0.4 ]
# 480569 1.2387500000000016
#   2%|█▏                                                          | 20/1000 [02:09<1:46:45,  6.54s/it]Returns [-2.4   4.6  -0.4  -0.4   3.6   8.16 -1.9   9.62 -1.4   4.6   5.7  -0.4
#  -2.4  -0.4   9.67 -0.4  -0.4   4.1   3.6   2.1   0.1   9.11  7.77 -0.4 ]
# 223699 2.5762500000000017
#   2%|█▎                                                          | 21/1000 [02:16<1:47:32,  6.59s/it]Returns [ 4.1  -0.4   4.6   4.6   0.6   4.1   4.6   4.6  -0.4  -0.4  -7.4   1.1
#  -5.4   4.6   8.61 -0.9   6.64  4.6   4.6   3.1   7.74 -0.4   4.1   4.6 ]
# 289648 2.566250000000003
#   2%|█▎                                                          | 22/1000 [02:22<1:48:02,  6.63s/it]Returns [ 0.1   9.1   8.62 -0.4  -3.4  -0.4  -1.9  -1.4   4.6   4.6   8.24  7.7
#  -4.4   4.6   4.6  -0.4   4.6   4.1   8.75  2.1   6.68  8.15  9.19 -0.4 ]
# 630715 3.4595833333333346
#   2%|█▍                                                          | 23/1000 [02:29<1:48:06,  6.64s/it]Returns [ 6.11 -0.9   3.1  -0.4   6.68 -1.4  -8.4   9.18  3.1  -0.4   9.15  4.6
#  -4.4  -0.4   3.6  -0.4   4.6   3.6   4.6   3.6   4.1   4.1   4.1  -0.4 ]
# 327297 2.3800000000000026
#   2%|█▍                                                          | 24/1000 [02:36<1:47:14,  6.59s/it]Returns [ 1.6   8.16  3.6  -3.4   8.63  4.1   4.6   4.1  -0.4  -0.4   9.1   7.12
#  -2.4   4.1  -0.4  -0.9   3.1   4.6   8.64  4.1  -1.4  -0.9   7.83 -0.4 ]
# 733130 3.0325000000000006
#   2%|█▌                                                          | 25/1000 [02:42<1:44:11,  6.41s/it]Returns [ 8.71  4.6   4.6  -1.4  -1.4  -5.4   2.6   4.6  -0.4  -3.9   3.6   3.6
#  -7.9   3.1   8.1  -0.4   3.6  -0.4   4.1   3.6   5.8   9.23 -0.9  -0.4 ]
# 653024 1.9725000000000026
#   3%|█▌                                                          | 26/1000 [02:48<1:43:27,  6.37s/it]Returns [ 0.1   4.6   4.1   4.6   4.1   2.1  -2.9   9.66  4.6  -0.4   9.63 -2.4
#  -3.9  -0.4  -1.4   4.6   4.6   4.1  -4.9   3.6   8.71 -0.4   6.23 -0.4 ]
# 454258 2.4262500000000022
#   3%|█▌                                                          | 27/1000 [02:54<1:42:03,  6.29s/it]Returns [-0.9   4.1   9.64 -0.4   7.15 -1.4   2.1   9.66 -0.4   4.6   9.12  8.27
#  -7.9   4.6  -0.9  -1.4   9.66  4.1  -0.9   3.6   3.1  -0.4   3.6  -0.4 ]
# 431266 2.845833333333335
#   3%|█▋                                                          | 28/1000 [03:00<1:39:29,  6.14s/it]Returns [-2.9   4.6   4.6  -1.4  -1.9   4.6   3.1   4.6   4.6   4.6   4.6   7.19
#  -3.4   4.6   4.1   4.1   9.64  3.1  -0.4   2.6   2.6  -0.4   9.25  4.6 ]
# 376804 3.1950000000000025
#   3%|█▋                                                          | 29/1000 [03:05<1:36:41,  5.97s/it]Returns [-0.4   4.6   4.1  -3.9  -2.4   5.28 -3.4   4.6   4.6   4.1   2.1   3.6
#  -2.9  -0.9   1.6  -0.4   4.6   4.6   7.19  3.1   3.1  -0.4   2.1   4.6 ]
# 739895 2.0487500000000027
#   3%|█▊                                                          | 30/1000 [03:11<1:36:25,  5.96s/it]Returns [ 8.61  3.1   4.6  -0.4   3.1   7.13  5.14  4.1  -0.9   7.14  4.6   3.6
#  -5.4  -0.9   8.16 -0.4   6.7   2.6   8.17  3.1   1.1  -0.9   6.79  4.6 ]
# 259317 3.476666666666669
#   3%|█▊                                                          | 31/1000 [03:17<1:33:07,  5.77s/it]Returns [ 1.6  -0.4   4.6   3.6   3.65 -0.4  -3.9   4.6  -0.4   4.6   8.11  2.1
#  -3.9  -0.4  -0.4   4.6   8.6   3.1   3.6   3.6   7.78  9.6  -0.4  -0.4 ]
# 184287 2.6308333333333356
#   3%|█▉                                                          | 32/1000 [03:22<1:31:56,  5.70s/it]Returns [-3.9  -0.4  -0.4   4.1  -0.4   1.6   3.6   9.69 -0.9  -0.4  -4.4   9.67
#  -6.4  -0.4  -0.9  -0.4   8.14  4.1   8.74  7.66  8.17 -0.4  -0.4   4.1 ]
# 708565 2.0779166666666686
#   3%|█▉                                                          | 33/1000 [03:28<1:32:46,  5.76s/it]Returns [ 1.6   8.21  4.6  -0.4   7.1   7.7  -2.4   4.6   4.6  -2.4   8.27  1.6
#  -5.4   4.1   4.6  -0.4   4.6   9.6   2.6   3.6   9.28  4.6  -2.4  -0.4 ]
# 646630 3.2275000000000027
#   3%|██                                                          | 34/1000 [03:34<1:31:54,  5.71s/it]Returns [-0.4   4.6  -1.9  -0.4  -0.4  -1.9   4.1   4.1   4.6   4.1   8.62  8.61
#  -6.4   3.6   9.13 -0.4   4.1   1.6   7.67  3.6   4.6   3.1  -3.4  -1.4 ]
# 471403 2.480416666666669
#   4%|██                                                          | 35/1000 [03:40<1:33:04,  5.79s/it]Returns [ 4.1  -1.4  -2.4   4.6   8.7   8.69 -6.4   9.21  4.1  -0.4  -6.9   3.6
#  -5.4  -0.4   2.1   4.1   4.6   4.1   3.6   4.1   8.79  4.6   4.1  -0.4 ]
# 817441 2.474583333333335
#   4%|██▏                                                         | 36/1000 [03:45<1:31:26,  5.69s/it]Returns [ 2.1   4.6   4.6   2.6  -3.4  -4.9   3.1   4.1  -0.4  -0.4   6.13  8.18
#  -4.9   4.6  -0.9  -0.4   4.1   4.6   4.6   2.1   9.6   4.1   9.22  4.1 ]
# 30777 2.7970833333333354
#   4%|██▏                                                         | 37/1000 [03:51<1:31:16,  5.69s/it]Returns [-1.4   4.6   4.1  -0.4  -2.4   9.1   5.62  3.1  -0.4  -1.4   4.65  4.6
#  -5.9  -1.9  -0.4   4.6   4.1   9.68 -0.4   3.6   5.18 -1.4   6.77  2.6 ]
# 920714 2.3458333333333354
#   4%|██▎                                                         | 38/1000 [03:56<1:31:17,  5.69s/it]Returns [-1.4   4.1   4.6  -0.4   7.11  4.6   4.1   4.1   9.65 -1.9   9.12  4.6
#  -4.4   3.1  -0.4   4.6   7.16  4.6   3.1   3.1   6.71 -0.4   2.6  -0.4 ]
# 729341 3.235416666666669
#   4%|██▎                                                         | 39/1000 [04:03<1:33:12,  5.82s/it]Returns [ 2.1   3.6   9.1   4.6  -2.4  -3.4   2.6   9.63 -1.4  -0.4   4.1   7.63
#  -1.4   2.6   9.61  4.6   9.27  4.6  -5.4   9.63  4.6  -0.4   7.67 -0.4 ]
# 392213 3.364166666666669
#   4%|██▍                                                         | 40/1000 [04:08<1:31:28,  5.72s/it]Returns [ 4.1   4.6   4.6   4.6  -5.4  -0.4   7.14  4.1  -0.4  -1.9   9.6   6.6
#  -4.9   4.1   8.64 -0.4   4.6   4.6   7.23  3.6   7.29 -0.4   3.6  -0.4 ]
# 254741 3.1166666666666685
#   4%|██▍                                                         | 41/1000 [04:13<1:29:53,  5.62s/it]Returns [ 1.6   4.6   3.1  -0.9   4.6  -3.4  -3.4  -2.9   4.1   2.1   0.1   3.6
#  -5.9  -0.4  -2.4   4.6  -0.4   3.1   4.6   7.62  2.6  -0.4   9.39 -0.9 ]
# 372807 1.4462500000000025
#   4%|██▌                                                         | 42/1000 [04:19<1:31:14,  5.71s/it]Returns [ 9.6  -7.4   0.6   3.6  -3.4  -1.4   1.1   3.1  -1.4  -0.4  -4.4  -3.4
#  -1.9   4.6   7.64 -0.4   2.1   3.1   4.6   3.6   3.6   3.6  -4.4  -0.4 ]
# 693935 0.9141666666666688
#   4%|██▌                                                         | 43/1000 [04:25<1:30:46,  5.69s/it]Returns [ 1.1   4.6  -0.4  -0.4   8.11 -0.4  -0.4   9.11 -0.4  -0.4   1.1  -3.4
#  -8.4   4.6   9.11 -0.4   9.6  -0.4   3.6  -2.4   3.1   4.1   5.61  4.6 ]
# 838890 2.1225000000000023
#   4%|██▋                                                         | 44/1000 [04:30<1:28:46,  5.57s/it]Returns [-4.4   2.6   4.6  -0.9   1.6   8.68 -5.4   4.1  -0.4  -1.9   9.6   8.2
#  -1.9   4.6   9.62 -0.4   4.1   4.6   7.14  3.1   1.67 -0.4   2.1   9.15]
# 279014 2.9066666666666685
#   4%|██▋                                                         | 45/1000 [04:36<1:30:31,  5.69s/it]Returns [-3.9   4.6   4.6  -0.4   2.1   4.6   4.6  -0.4  -0.4  -0.4   6.1   4.6
#  -2.4  -1.9   9.61 -2.4  -0.4   4.6   3.1   3.1   8.14 -1.4   4.1  -0.4 ]
# 538199 2.060416666666669
#   5%|██▊                                                         | 46/1000 [04:43<1:35:57,  6.03s/it]Returns [ -4.9    4.1   -0.4   -0.4   -1.4   -2.4   -1.9    3.6    4.6    4.1
#    9.12   3.6  -10.4   -1.4   -0.4   -0.4    9.67   4.6    4.6    3.6
#    4.1   -0.4    1.61  -0.4 ]
# 269912 1.3541666666666687
#   5%|██▊                                                         | 47/1000 [04:50<1:37:48,  6.16s/it]Returns [ 3.6   4.6   4.6  -0.4   9.21  1.6  -5.4   3.6   4.6   4.6   7.17 -4.9
#  -4.4  -0.4  -1.4  -0.4   4.1   4.6   4.6   2.6   7.22  4.1   2.6  -1.4 ]
# 164360 2.279166666666669
#   5%|██▉                                                         | 48/1000 [04:56<1:39:24,  6.27s/it]Returns [ 1.6   4.1   9.13 -0.9   9.14  4.1  -2.4   8.11  4.6  -1.4   2.1   7.66
#  -4.9   0.1   9.79 -1.9   4.1   2.1   4.6   3.6   7.11  9.14  3.6  -0.4 ]
# 874460 3.449166666666669
#   5%|██▉                                                         | 49/1000 [05:03<1:42:19,  6.46s/it]Returns [-0.9   4.6  -0.4  -0.4   2.6  -0.9   7.62 -0.4   4.1   7.61  8.21  4.6
#  -3.9   4.6   3.6  -0.4   4.6   9.65  7.14  3.6   0.6   4.1   4.6  -0.4 ]
# 966200 3.0887500000000014
#   5%|███                                                         | 50/1000 [05:10<1:43:54,  6.56s/it]Returns [ 0.6   4.6   4.6  -4.9   8.71  3.6   4.6   4.6   4.6   4.6   9.66  3.1
#  -1.4   4.6   3.1  -0.4   4.1   2.6   4.6   2.1   5.29  4.6   9.64  3.6 ]
# 312612 3.7833333333333354
#   5%|███                                                         | 51/1000 [05:16<1:43:07,  6.52s/it]Returns [ 2.1  -0.4  -0.4   4.6   6.62 -2.4  -2.4   4.1   4.6  -0.9   8.29  7.78
#  -7.4  -0.9  -2.4   4.1   0.6   8.6   9.63  3.6   4.6  -0.4   3.6  -0.4 ]
# 97319 2.284166666666669
#   5%|███                                                         | 52/1000 [05:21<1:36:25,  6.10s/it]Returns [-4.4  -0.4   3.6   4.6   8.74 -0.9   8.62 -0.4   4.6   4.6   9.66  0.1
#  -2.4   4.6   2.1  -0.4   3.6   4.1   4.6   3.6   0.6   4.6   4.1  -0.4 ]
# 149455 2.7966666666666686
#   5%|███▏                                                        | 53/1000 [05:26<1:31:23,  5.79s/it]Returns [ 2.6  -0.4  -2.4   8.16  8.18  2.6  -0.9  -1.4   4.1   4.6  -7.4  -0.9
#  -5.4   3.1  -0.9   4.6   4.6   1.1  -0.4   1.6  -0.9   4.1   3.1  -0.4 ]
# 466360 1.2933333333333354
#   5%|███▏                                                        | 54/1000 [05:32<1:28:46,  5.63s/it]Returns [-0.9   4.6   4.1  -0.4  -5.4   2.1   5.12  4.6   4.1  -0.4  -0.4   3.6
#  -2.9   4.1   7.64  4.1   2.6   4.6   4.6   3.6   3.1   4.1  -0.9   4.1 ]
# 318121 2.4775000000000023
#   6%|███▎                                                        | 55/1000 [05:38<1:30:48,  5.77s/it]Returns [-1.9  -1.4   3.6  -0.4   9.66 -2.9  -2.4   4.1   3.6   4.6   9.19  3.1
#  -5.9  -0.9   4.6  -1.9  -0.4  -1.9   3.6   3.6   3.1   4.1   3.6  -0.9 ]
# 998364 1.647916666666669
#   6%|███▎                                                        | 56/1000 [05:44<1:35:38,  6.08s/it]Returns [ 7.62  4.6  -2.4   2.1   6.63 -2.9  -2.4   6.13  9.17  4.6   6.61  9.28
#  -2.4   4.6   9.18 -0.4   3.6   4.6   4.1   3.6   8.72 -0.4   5.63 -1.4 ]
# 952810 3.6862500000000016
#   6%|███▍                                                        | 57/1000 [05:51<1:39:11,  6.31s/it]Returns [-1.9  -4.9  -0.4   8.14  8.73  8.13  3.6  -0.4  -0.9  -0.4   3.6  -3.4
#  -4.4  -0.9   4.1   4.1  -0.9   4.6   9.1   6.23  8.71 -0.4   7.15 -0.4 ]
# 857419 2.370416666666669
#   6%|███▍                                                        | 58/1000 [05:58<1:41:55,  6.49s/it]Returns [ 8.61  4.1   4.6  -2.9   4.14  0.6   3.1   3.6  -0.4   9.11  9.2  -0.4
#  -6.4  -0.4   4.1  -0.4   4.6   4.1   3.6   4.1   5.73  4.6   3.6   9.11]
# 153599 3.320833333333335
#   6%|███▌                                                        | 59/1000 [06:05<1:42:05,  6.51s/it]Returns [ 4.65 -0.4   4.6   4.1  -2.9  -4.9   2.1  -0.4  -0.9  -0.4   6.28  7.67
#  -3.9   4.1   3.6   4.6   4.6   2.6   4.6   4.1   7.73  4.6  -2.4   3.1 ]
# 565574 2.367916666666669
#   6%|███▌                                                        | 60/1000 [06:11<1:39:02,  6.32s/it]Returns [-2.9   4.1  -2.4   9.2   5.12  4.6   2.1  -1.4   4.6  -3.4   0.6   2.6
#  -1.4  -0.9   7.71  4.6   0.1   8.63 -0.4   3.6   5.63 -0.4   4.1   4.6 ]
# 499178 2.445416666666669
#   6%|███▋                                                        | 61/1000 [06:16<1:34:57,  6.07s/it]Returns [ 7.61  2.1   4.1  -0.4   1.6   2.1  -0.9   4.6   4.6  -2.4  -2.4  -0.9
#  -2.9   4.1  -0.9  -0.9   4.1   4.1   3.1   2.6   4.6  -0.4   3.6  -0.4 ]
# 458482 1.6837500000000023
#   6%|███▋                                                        | 62/1000 [06:22<1:35:18,  6.10s/it]Returns [ 8.11 -1.9   3.1   4.1   1.1  -0.9   4.6  -0.4   4.6   4.6   6.72  8.3
#  -7.9  -0.4   8.71 -0.4   3.6   2.1   8.68  3.6   5.11  4.1   2.6   4.6 ]
# 271090 3.184583333333336
#   6%|███▊                                                        | 63/1000 [06:28<1:32:24,  5.92s/it]Returns [ 0.1   4.6   4.1   3.6   9.18  0.1   4.1  -0.4  -0.4  -0.4   3.1   4.6
#  -2.9  -0.4   4.1  -0.4   3.6   9.6   4.6   3.6   3.6  -1.9  -5.4  -1.4 ]
# 880842 2.040833333333336
#   6%|███▊                                                        | 64/1000 [06:33<1:30:49,  5.82s/it]Returns [ 0.1   4.6   4.6   4.1   1.6   0.1   4.6   8.71 -0.4   9.21  3.1   3.6
#  -2.4  -1.4  -1.4   7.67  3.6   8.66  9.67  3.6   8.86  2.6   9.79 -0.4 ]
# 593110 3.8654166666666683
#   6%|███▉                                                        | 65/1000 [06:39<1:28:35,  5.69s/it]Returns [-2.9   3.1   4.6   4.6   5.69 -1.9   4.6   3.1   4.6  -0.4   9.2   6.12
#  -7.4   3.1   9.67 -0.4   6.77  4.6   4.6   3.1   8.81 -0.4   3.6  -0.4 ]
# 694109 3.169166666666669
#   7%|███▉                                                        | 66/1000 [06:44<1:26:53,  5.58s/it]Returns [ 1.6   3.6   9.13 -0.4   7.2  -7.9   6.65  4.1  -1.9   4.6   8.62  4.6
#  -5.9  -0.4   3.1  -0.4   2.6   4.1   9.11  8.11  3.12  4.1   8.85 -0.4 ]
# 421292 3.162083333333335
#   7%|████                                                        | 67/1000 [06:50<1:28:14,  5.67s/it]Returns [-2.9  -0.4  -0.9   4.6   1.17 -6.9   4.1   4.6   4.1  -0.4   6.61  9.71
#  -7.4  -0.9   5.18 -0.4   9.22  4.1   4.6   3.1   3.6  -0.9   4.1   4.6 ]
# 451185 2.178750000000002
#   7%|████                                                        | 68/1000 [06:56<1:30:45,  5.84s/it]Returns [-1.9   4.1   4.6   4.6   5.21 -3.9   9.13  4.6   4.1  -0.4   3.6   1.6
#  -2.4   4.1   9.62 -0.9   4.1   4.1   4.6   4.1   5.69  9.64  1.1  -0.4 ]
# 888608 3.2787500000000023
#   7%|████▏                                                       | 69/1000 [07:02<1:32:04,  5.93s/it]Returns [-0.4   4.63  4.1   4.6   5.61 -0.9   3.1   3.6  -0.4   4.1   3.6  -4.9
#  -8.9  -0.4   4.1  -0.4   4.6   9.22 -1.9   1.1   1.1   8.14  3.6   4.6 ]
# 232029 2.1500000000000026
#   7%|████▏                                                       | 70/1000 [07:08<1:28:59,  5.74s/it]Returns [-6.9   8.14  3.6  -0.4   8.17  4.6   4.1   4.6  -0.9   2.6   2.6  -2.4
#  -3.9  -0.4   4.6  -0.4   4.6   9.13  0.6   8.15  2.1  -0.4   4.68 -0.4 ]
# 386835 2.340416666666668
#   7%|████▎                                                       | 71/1000 [07:13<1:27:37,  5.66s/it]Returns [ 4.1   8.17  4.6  -0.4   2.6   9.76  4.1   9.11 -1.9   7.11  5.7   4.1
#  -2.4   1.6   4.6  -0.4   8.75 -0.4   9.65  2.6   6.1  -0.4   8.83 -0.9 ]
# 68716 3.9450000000000007
#   7%|████▎                                                       | 72/1000 [07:19<1:27:44,  5.67s/it]Returns [-2.9  -0.9  -0.4  -0.4   8.69  0.6   6.12  4.1   9.14  4.1   9.14 -3.9
#  -5.9   2.6  -0.4   8.61  4.6   4.6   8.15  2.6   8.73 -0.4   4.6  -0.4 ]
# 712143 2.9491666666666685
#   7%|████▍                                                       | 73/1000 [07:24<1:25:38,  5.54s/it]Returns [ 0.6   4.6  -3.9  -0.9   4.1  -1.4  -0.4   8.62  4.6  -0.4   8.64  3.6
#  -4.4  -0.4   0.6   4.6   4.1   8.21  9.72  8.64  4.6  -0.4   1.6   4.1 ]
# 322238 2.8637500000000027
#   7%|████▍                                                       | 74/1000 [07:31<1:29:56,  5.83s/it]Returns [ 5.64 -1.9  -0.9  -0.4   6.18  8.64  4.6   4.6  -1.4  -1.4   2.6   4.11
#  -4.9   4.1   9.11  4.6  -0.4   4.1   4.1   8.16  2.6   4.1   6.64  4.1 ]
# E 314932 3.1950000000000025
#   7%|████▍                                                       | 74/1000 